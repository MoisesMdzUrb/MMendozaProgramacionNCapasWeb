<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns:th="http://www.thymeleaf.org"      
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layaout"
      layout:decorate="~{layout}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Edición</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    </head>

    <body layout:fragment="body">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <br/>
        <br/>
        <div class="container">
            <form th:action="@{/usuario/form}" method="post" th:object="${usuariodireccion}" enctype="multipart/form-data">

                <input type="hidden" th:field="*{usuario.idusuario}">

                <h3><center>Usuario</center></h3>
                <div class="row">
                    <div class="form-group">
                        <label for="imagenFile">Imagen:</label>
                        <input type="file" class="form-control" name="imagenFile" id="imagenFile" onchange="mostrarVistaPrevia()">
                    </div>

                    <div class="form-group">
                        <img id="vistaPrevia" src="#" alt="Vista previa de la imagen" style="max-width: 100%; max-height: 200px;">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-fill"></i></span>
                            <input type="text" class="form-control" placeholder="Nombre" onkeypress="return SoloLetras(event, 'lblNombre')" id="nombre" name="nombre" th:field="*{usuario.nombre}"/>
                        </div>
                        <label id="lblNombre"></label>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-fill"></i></span>
                            <input type="text" class="form-control" placeholder="Apellido Paterno" onkeypress="return SoloLetras(event, 'lblApellidoPaterno')" id="apellidopaterno" name="apellidopaterno" th:field="*{usuario.apellidopaterno}">
                        </div>
                        <label id="lblApellidoPaterno"></label>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-fill"></i></span>
                            <input type="text" class="form-control" placeholder="Apellido Materno" onkeypress="return SoloLetras(event, 'lblApellidoMaterno')" id="apellidomaterno" name="apellidomaterno" th:field="*{usuario.apellidomaterno}">
                        </div>
                        <label id="lblApellidoMaterno"></label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi-calendar-plus"></i></span>
                            <input type="date" class="form-control"  id="fechanacimiento" name="fechanacimiento" th:field="*{usuario.fechanacimiento}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-fill"></i></span>
                            <input type="text" class="form-control" placeholder="UserName" id="username" name="username" th:field="*{usuario.username}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1">@</span>
                            <input type="text" class="form-control" placeholder="Email" id="email" name="email" th:field="*{usuario.email}">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-clipboard2"></span>
                            <input type="text" class="form-control" placeholder="Password" id="password" name="password" th:field="*{usuario.password}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-person-fill"></span>
                            <div clas="form-check form-check-inline">
                                <input type="radio" class="form-check-input"  value="M" id="sexo" name="sexo" th:field="*{usuario.sexo}">
                                <label class="form-check-label" for="sexo">
                                    Masculino
                                </label>
                            </div>
                            <div clas="form-check form-check-inline">
                                <input type="radio" class="form-check-input"  value="F" id="sexo" name="sexo" th:field="*{usuario.sexo}">
                                <label class="form-check-label" for="sexo">
                                    Femenino
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-telephone-plus"></span>
                            <input type="text" class="form-control" placeholder="Telefono" id="telefono" name="telefono" onkeypress="return solonumeros(event, 'numTelefono', this)" th:field="*{usuario.telefono}" required>
                        </div>
                        <label id="numTelefono"></label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-phone"></span>
                            <input type="text" class="form-control" placeholder="Celular" id="celular" name="celular" onkeypress="return solonumeros(event, 'numCelular', this)" th:field="*{usuario.celular}" required>
                        </div>
                        <label id="numCelular"></label>

                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-list-ol"></span>
                            <input type="text" class="form-control" placeholder="CURP" id="curp" name="curp" th:field="*{usuario.curp}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-person-bounding-box"></span>
                            <select class="form-select" aria-label="Default select example" name="rol.idrol" id="rol" th:field="*{usuario.rol.idrol}">
                                <option value="0">Seleccione un Rol</option>
                                <option th:each="rol : ${roles}" th:value="${rol.idrol}" th:text="${rol.nombre}"></option>
                            </select>
                        </div>
                    </div>
                </div>
                <h3><center>Direccion</center></h3>
                <div class="row">
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <input type="text" class="form-control" placeholder="Calle" id="calle" name="calle" th:field="*{direccion.calle}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <input type="text" class="form-control" placeholder="Numero Exterior" id="numeroexterior" name="numeroexterior" th:field="*{direccion.numeroexterior}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <input type="text" class="form-control" placeholder="Numero Interior" id="numerointerior" name="numerointerior" th:field="*{direccion.numerointerior}">
                        </div>
                    </div>
                </div>                
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <select class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.estado.pais.idpais" id="ddlPais" th:field="*{direccion.colonia.municipio.estado.pais.idpais}">
                                <option value="0">Seleccione un pais</option>
                                <option th:each="pais : ${paises}" th:value="${pais.idpais}" th:text="${pais.nombre}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <select th:if="${Estados == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.estado.idestado" id="ddlEstado">                                
                                <option value="0">Seleccione un estado</option>
                            </select>
                            <select th:unless="${Estados == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.estado.idestado" id="ddlEstado">                                
                                <option th:each="Estado : ${Estados}" th:value="${Estado.idestado}" th:text="${Estado.nombre}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span>
                            <select class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.idmunicipio" id="ddlMunicipio">
                                <option value="0">Seleccione un municipio</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group mb-3">
                            <span class="bi bi-geo-alt-fill"></span> 
                            <select class="form-select" aria-label="Default select example" name="direccion.colonia.idcolonia" id="ddlColonia" >
                                <option value="0">Seleccione una colonia</option>
                                <option th:each="colonia : ${colonias}" th:value="${colonia.idcolonia}" th:text="colonia.nombre}"></option>
                            </select>
                        </div> 
                    </div>
                </div>
                <br/>
                <hr/>
                <br/>

                <div class="row">
                    <div class="d-flex justify-content-center">
                        <button type="submit" class="btn btn-success col-md-4">Guardar <i class="bi bi-floppy2-fill"></i></button>
                    </div>
                </div>
            </form>
        </div>
    </body>
</html>

<script>
    function SoloLetras(e, lbl)
    {
        var letters = /^[A-Za-z]+$/;
        var key = e.key;
        if (key.match(letters))
        {
            document.getElementById(lbl).innerHTML = "";
            return true;
        } else
        {
            document.getElementById(lbl).innerHTML = "Ingresa solo letras";
            $("#" + lbl).css('color', 'red');
            return false;
        }
    }

    function solonumeros(e, lbl, inputField) {
        var numbers = /^[0-9]+$/;
        var key = e.key;

        if (key.match(numbers)) {
            document.getElementById(lbl).innerHTML = "";
            inputField.classList.remove("input-error");
            return true;
        } else {
            document.getElementById(lbl).innerHTML = "Solo Números";
            $("#" + lbl).css('color', 'red');
            inputField.classList.add("input-error");
            return false;
        }
    }

    function mostrarVistaPrevia() {
        var input = document.getElementById('imagenFile');
        var vistaPrevia = document.getElementById('vistaPrevia');
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                vistaPrevia.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $(document).ready(function () {
        $("#ddlPais").change(function () {
            $.ajax({
                type: "GET",
                url: "/usuario/GetEstadoByIdPais",
                dataType: "json",
                data: {IdPais: $("#ddlPais").val()},
                success: function (estados) {
                    $("#ddlEstado").empty();
                    $("#ddlEstado").append('<option value="0">' + 'Seleccione un estado' + '</option>');
                    $.each(estados, function (i, estado) {
                        $("#ddlEstado").append('<option value="'
                                + estado.idestado + '">'
                                + estado.nombre + '</option>');
                    });
                },
                error: function () {
                    alert("Error al obtener datos.");
                }
            });
        });

        $("#ddlEstado").change(function () {
            $.ajax({
                type: "GET",
                url: "/usuario/GetMunicipioByIdEstado",
                dataType: "json",
                data: {IdEstado: $("#ddlEstado").val()},
                success: function (municipios) {
                    $("#ddlMunicipio").empty();
                    $("#ddlMunicipio").append('<option value="0">' + 'Seleccione un municipio' + '</option>');
                    $.each(municipios, function (i, municipio) {
                        $("#ddlMunicipio").append('<option value="'
                                + municipio.idmunicipio + '">'
                                + municipio.nombre + '</option>');
                    });
                },
                error: function () {
                    alert("Error al obtener datos.");
                }
            });
        });

        $("#ddlMunicipio").change(function () {
            $.ajax({
                type: "GET",
                url: "/usuario/GetColoniaByIdMunicipio",
                dataType: "json",
                data: {IdMunicipio: $("#ddlMunicipio").val()},
                success: function (colonias) {
                    $("#ddlColonia").empty();
                    $("#ddlColonia").append('<option value="0">' + 'Seleccione una colonia' + '</option>');
                    $.each(colonias, function (i, colonia) {
                        $("#ddlColonia").append('<option value="'
                                + colonia.idcolonia + '">'
                                + colonia.nombre + '</option>');
                    });
                },
                error: function () {
                    alert("Error al obtener datos.");
                }
            });
        });
    });



</script>
